{"ast":null,"code":"import { dropUndefinedKeys } from '@sentry/utils';\n\n/**\n * Generate bucket key from metric properties.\n */\nfunction getBucketKey(metricType, name, unit, tags) {\n  const stringifiedTags = Object.entries(dropUndefinedKeys(tags)).sort((a, b) => a[0].localeCompare(b[0]));\n  return `${metricType}${name}${unit}${stringifiedTags}`;\n}\n\n/* eslint-disable no-bitwise */\n/**\n * Simple hash function for strings.\n */\nfunction simpleHash(s) {\n  let rv = 0;\n  for (let i = 0; i < s.length; i++) {\n    const c = s.charCodeAt(i);\n    rv = (rv << 5) - rv + c;\n    rv &= rv;\n  }\n  return rv >>> 0;\n}\n/* eslint-enable no-bitwise */\n\n/**\n * Serialize metrics buckets into a string based on statsd format.\n *\n * Example of format:\n * metric.name@second:1:1.2|d|#a:value,b:anothervalue|T12345677\n * Segments:\n * name: metric.name\n * unit: second\n * value: [1, 1.2]\n * type of metric: d (distribution)\n * tags: { a: value, b: anothervalue }\n * timestamp: 12345677\n */\nfunction serializeMetricBuckets(metricBucketItems) {\n  let out = '';\n  for (const item of metricBucketItems) {\n    const tagEntries = Object.entries(item.tags);\n    const maybeTags = tagEntries.length > 0 ? `|#${tagEntries.map(([key, value]) => `${key}:${value}`).join(',')}` : '';\n    out += `${item.name}@${item.unit}:${item.metric}|${item.metricType}${maybeTags}|T${item.timestamp}\\n`;\n  }\n  return out;\n}\n\n/** Sanitizes units */\nfunction sanitizeUnit(unit) {\n  return unit.replace(/[^\\w]+/gi, '_');\n}\n\n/** Sanitizes metric keys */\nfunction sanitizeMetricKey(key) {\n  return key.replace(/[^\\w\\-.]+/gi, '_');\n}\nfunction sanitizeTagKey(key) {\n  return key.replace(/[^\\w\\-./]+/gi, '');\n}\nconst tagValueReplacements = [['\\n', '\\\\n'], ['\\r', '\\\\r'], ['\\t', '\\\\t'], ['\\\\', '\\\\\\\\'], ['|', '\\\\u{7c}'], [',', '\\\\u{2c}']];\nfunction getCharOrReplacement(input) {\n  for (const [search, replacement] of tagValueReplacements) {\n    if (input === search) {\n      return replacement;\n    }\n  }\n  return input;\n}\nfunction sanitizeTagValue(value) {\n  return [...value].reduce((acc, char) => acc + getCharOrReplacement(char), '');\n}\n\n/**\n * Sanitizes tags.\n */\nfunction sanitizeTags(unsanitizedTags) {\n  const tags = {};\n  for (const key in unsanitizedTags) {\n    if (Object.prototype.hasOwnProperty.call(unsanitizedTags, key)) {\n      const sanitizedKey = sanitizeTagKey(key);\n      tags[sanitizedKey] = sanitizeTagValue(String(unsanitizedTags[key]));\n    }\n  }\n  return tags;\n}\nexport { getBucketKey, sanitizeMetricKey, sanitizeTags, sanitizeUnit, serializeMetricBuckets, simpleHash };","map":{"version":3,"names":["getBucketKey","metricType","name","unit","tags","stringifiedTags","Object","entries","dropUndefinedKeys","sort","a","b","localeCompare","simpleHash","s","rv","i","length","c","charCodeAt","serializeMetricBuckets","metricBucketItems","out","item","tagEntries","maybeTags","map","key","value","join","metric","timestamp","sanitizeUnit","replace","sanitizeMetricKey","sanitizeTagKey","tagValueReplacements","getCharOrReplacement","input","search","replacement","sanitizeTagValue","reduce","acc","char","sanitizeTags","unsanitizedTags","prototype","hasOwnProperty","call","sanitizedKey","String"],"sources":["/Users/jeffreydebolt/Documents/fifo/cogs-dashboard/node_modules/@sentry/src/metrics/utils.ts"],"sourcesContent":["import type { MeasurementUnit, MetricBucketItem, Primitive } from '@sentry/types';\nimport { dropUndefinedKeys } from '@sentry/utils';\nimport type { MetricType } from './types';\n\n/**\n * Generate bucket key from metric properties.\n */\nexport function getBucketKey(\n  metricType: MetricType,\n  name: string,\n  unit: MeasurementUnit,\n  tags: Record<string, string>,\n): string {\n  const stringifiedTags = Object.entries(dropUndefinedKeys(tags)).sort((a, b) => a[0].localeCompare(b[0]));\n  return `${metricType}${name}${unit}${stringifiedTags}`;\n}\n\n/* eslint-disable no-bitwise */\n/**\n * Simple hash function for strings.\n */\nexport function simpleHash(s: string): number {\n  let rv = 0;\n  for (let i = 0; i < s.length; i++) {\n    const c = s.charCodeAt(i);\n    rv = (rv << 5) - rv + c;\n    rv &= rv;\n  }\n  return rv >>> 0;\n}\n/* eslint-enable no-bitwise */\n\n/**\n * Serialize metrics buckets into a string based on statsd format.\n *\n * Example of format:\n * metric.name@second:1:1.2|d|#a:value,b:anothervalue|T12345677\n * Segments:\n * name: metric.name\n * unit: second\n * value: [1, 1.2]\n * type of metric: d (distribution)\n * tags: { a: value, b: anothervalue }\n * timestamp: 12345677\n */\nexport function serializeMetricBuckets(metricBucketItems: MetricBucketItem[]): string {\n  let out = '';\n  for (const item of metricBucketItems) {\n    const tagEntries = Object.entries(item.tags);\n    const maybeTags = tagEntries.length > 0 ? `|#${tagEntries.map(([key, value]) => `${key}:${value}`).join(',')}` : '';\n    out += `${item.name}@${item.unit}:${item.metric}|${item.metricType}${maybeTags}|T${item.timestamp}\\n`;\n  }\n  return out;\n}\n\n/** Sanitizes units */\nexport function sanitizeUnit(unit: string): string {\n  return unit.replace(/[^\\w]+/gi, '_');\n}\n\n/** Sanitizes metric keys */\nexport function sanitizeMetricKey(key: string): string {\n  return key.replace(/[^\\w\\-.]+/gi, '_');\n}\n\nfunction sanitizeTagKey(key: string): string {\n  return key.replace(/[^\\w\\-./]+/gi, '');\n}\n\nconst tagValueReplacements: [string, string][] = [\n  ['\\n', '\\\\n'],\n  ['\\r', '\\\\r'],\n  ['\\t', '\\\\t'],\n  ['\\\\', '\\\\\\\\'],\n  ['|', '\\\\u{7c}'],\n  [',', '\\\\u{2c}'],\n];\n\nfunction getCharOrReplacement(input: string): string {\n  for (const [search, replacement] of tagValueReplacements) {\n    if (input === search) {\n      return replacement;\n    }\n  }\n\n  return input;\n}\n\nfunction sanitizeTagValue(value: string): string {\n  return [...value].reduce((acc, char) => acc + getCharOrReplacement(char), '');\n}\n\n/**\n * Sanitizes tags.\n */\nexport function sanitizeTags(unsanitizedTags: Record<string, Primitive>): Record<string, string> {\n  const tags: Record<string, string> = {};\n  for (const key in unsanitizedTags) {\n    if (Object.prototype.hasOwnProperty.call(unsanitizedTags, key)) {\n      const sanitizedKey = sanitizeTagKey(key);\n      tags[sanitizedKey] = sanitizeTagValue(String(unsanitizedTags[key]));\n    }\n  }\n  return tags;\n}\n"],"mappings":";;AAIA;AACA;AACA;AACO,SAASA,YAAYA,CAC1BC,UAAU,EACVC,IAAI,EACJC,IAAI,EACJC,IAAI,EACI;EACR,MAAMC,eAAA,GAAkBC,MAAM,CAACC,OAAO,CAACC,iBAAiB,CAACJ,IAAI,CAAC,CAAC,CAACK,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAAC,CAAC,CAAC,CAACE,aAAa,CAACD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACxG,OAAO,GAACV,UAAA,GAAAC,IAAA,GAAAC,IAAA,GAAAE,eAAA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAAQ,WAAAC,CAAA;EACA,IAAAC,EAAA;EACA,SAAAC,CAAA,MAAAA,CAAA,GAAAF,CAAA,CAAAG,MAAA,EAAAD,CAAA;IACA,MAAAE,CAAA,GAAAJ,CAAA,CAAAK,UAAA,CAAAH,CAAA;IACAD,EAAA,IAAAA,EAAA,SAAAA,EAAA,GAAAG,CAAA;IACAH,EAAA,IAAAA,EAAA;EACA;EACA,OAAAA,EAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAAK,uBAAAC,iBAAA;EACA,IAAAC,GAAA;EACA,WAAAC,IAAA,IAAAF,iBAAA;IACA,MAAAG,UAAA,GAAAlB,MAAA,CAAAC,OAAA,CAAAgB,IAAA,CAAAnB,IAAA;IACA,MAAAqB,SAAA,GAAAD,UAAA,CAAAP,MAAA,YAAAO,UAAA,CAAAE,GAAA,GAAAC,GAAA,EAAAC,KAAA,SAAAD,GAAA,IAAAC,KAAA,IAAAC,IAAA;IACAP,GAAA,OAAAC,IAAA,CAAArB,IAAA,IAAAqB,IAAA,CAAApB,IAAA,IAAAoB,IAAA,CAAAO,MAAA,IAAAP,IAAA,CAAAtB,UAAA,GAAAwB,SAAA,KAAAF,IAAA,CAAAQ,SAAA;EACA;EACA,OAAAT,GAAA;AACA;;AAEA;AACA,SAAAU,aAAA7B,IAAA;EACA,OAAAA,IAAA,CAAA8B,OAAA;AACA;;AAEA;AACA,SAAAC,kBAAAP,GAAA;EACA,OAAAA,GAAA,CAAAM,OAAA;AACA;AAEA,SAAAE,eAAAR,GAAA;EACA,OAAAA,GAAA,CAAAM,OAAA;AACA;AAEA,MAAAG,oBAAA,IACA,eACA,eACA,eACA,gBACA,kBACA,iBACA;AAEA,SAAAC,qBAAAC,KAAA;EACA,YAAAC,MAAA,EAAAC,WAAA,KAAAJ,oBAAA;IACA,IAAAE,KAAA,KAAAC,MAAA;MACA,OAAAC,WAAA;IACA;EACA;EAEA,OAAAF,KAAA;AACA;AAEA,SAAAG,iBAAAb,KAAA;EACA,WAAAA,KAAA,EAAAc,MAAA,EAAAC,GAAA,EAAAC,IAAA,KAAAD,GAAA,GAAAN,oBAAA,CAAAO,IAAA;AACA;;AAEA;AACA;AACA;AACA,SAAAC,aAAAC,eAAA;EACA,MAAA1C,IAAA;EACA,WAAAuB,GAAA,IAAAmB,eAAA;IACA,IAAAxC,MAAA,CAAAyC,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAH,eAAA,EAAAnB,GAAA;MACA,MAAAuB,YAAA,GAAAf,cAAA,CAAAR,GAAA;MACAvB,IAAA,CAAA8C,YAAA,IAAAT,gBAAA,CAAAU,MAAA,CAAAL,eAAA,CAAAnB,GAAA;IACA;EACA;EACA,OAAAvB,IAAA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}